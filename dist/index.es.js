import e,{useReducer as t,createContext as a,useContext as n,useCallback as l,useEffect as o}from"react";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},r.apply(this,arguments)}const c={SetRepeat:"SetRepeat",SetFrequency:"SetFrequency",SetMonthOption:"SetMonthOption",SetSelectedWeeks:"SetSelectedWeeks",SetMonthDate:"SetMonthDate",SetMonthDay:"SetMonthDay",SetMonthDayOrder:"SetMonthDayOrder",SetInitialProps:"SetInitialProps",SetEndType:"SetEndType",SetEndDate:"SetEndDate",SetEndCount:"SetEndCount",SetStartDate:"SetStartDate",SetCronExp:"SetCronExp"},d=(e=null)=>{let t=new Date;e&&(t=new Date(e));let a=t.getDate(),n=t.getMonth()+1;return a<10&&(a=`0${a}`),n<10&&(n=`0${n}`),`${t.getFullYear()}-${n}-${a}`},i=e=>"number"==typeof e?d(e):e,s=(e,t)=>{switch(t.type){case c.SetRepeat:return{...e,repeat:t.payload};case c.SetFrequency:return{...e,frequency:Number(t.payload)};case c.SetMonthOption:return{...e,monthOption:t.payload};case c.SetSelectedWeeks:return{...e,selectedWeeks:t.payload||[]};case c.SetMonthDate:return{...e,selectedMonthDate:Number(t.payload)};case c.SetMonthDay:return{...e,selectedMonthDay:t.payload};case c.SetMonthDayOrder:return{...e,selectedMonthDayOrder:t.payload};case c.SetStartDate:return{...e,startDate:t.payload};case c.SetEndType:return{...e,selectedEndType:t.payload};case c.SetEndDate:return{...e,endDate:t.payload};case c.SetEndCount:return{...e,endCount:Number(t.payload)};case c.SetInitialProps:return{...e,repeat:t.payload?.repeat,disabled:t.payload?.disabled,showFrequency:t.payload?.showFrequency,frequency:t.payload?.frequency||1,startDate:t.payload?.startDate?i(t.payload?.startDate):d(),endDate:t.payload?.endDate?i(t.payload?.endDate):d(),selectedEndType:t.payload?.selectedEndType||"noend",endCount:t.payload?.endCount||10,selectedWeeks:t.payload?.selectedWeeks||[(new Date).getDay()],monthOption:t.payload?.monthOption||"standard",selectedMonthDate:t.payload?.selectedMonthDate||(new Date).getDate(),selectedMonthDayOrder:t.payload?.selectedMonthDayOrder||"First",selectedMonthDay:t.payload?.selectedMonthDay||"Day"};case c.SetCronExp:return{...e,cronExpression:t.payload};default:return e}},u=a({}),m={repeat:"weekly",frequency:1,selectedWeeks:[(new Date).getDay()],monthOption:"standard",selectedMonthDate:(new Date).getDate(),selectedMonthDayOrder:"First",selectedMonthDay:"Day",selectedEndType:"noend",startDate:d(),endDate:d(),endCount:10,disabled:!1,showFrequency:!0,cronExpression:""};var p=a=>{const[n,l]=t(s,m);return e.createElement(u.Provider,{value:{recurrenceData:n,dispatch:l}},a.children)};const y=[{name:"Sunday",value:0},{name:"Monday",value:1},{name:"Tuesday",value:2},{name:"Wednesday",value:3},{name:"Thursday",value:4},{name:"Friday",value:5},{name:"Saturday",value:6}],_=["January","February","March","April","May","June","July","August","September","October","November","December"],h=e=>e&&e.length>0?7===e.length?"0 0 ? * ?":(e.sort(),`0 0 ? * ${e.join(",")}`):"",S=e=>e&&e>=1&&e<=31?`0 0 ${e} * ?`:"",D=e=>{const t=y.find((t=>t.name===e))?.value;return t>=0&&t<=6?`0 0 ? * ${t}L`:""},E=(e,t)=>{const a=y.find((e=>e.name===t))?.value;return e>=1&&e<=4&&a>=0&&a<=6?`0 0 ? * ${a}#${e}`:""},b=e=>"First"===e?1:"Second"===e?2:"Third"===e?3:"Fourth"===e?4:5,g=e=>1===e||"1"===e?"First":2===e||"2"===e?"Second":3===e||"3"===e?"Third":4===e||"4"===e?"Fourth":"Last",f=(e,t)=>{if(!t)return{};const a=t.split(" ");if(a.length<5)return{};const n={},l=a[4],o=a[3],r=a[2];if("weekly"===e){if(n.selectedWeeks="?"===l?[0,1,2,3,4,5,6]:l.split(",").map((e=>Number(e))),"?"===l)return n.selectedWeeks=[0,1,2,3,4,5,6],n;const e=[];return l.split(",").forEach((t=>{if(Number.isNaN(t)||Number.isNaN(parseFloat(t))){const n="SUN"===(a=t)?.toUpperCase()?0:"MON"===a?.toUpperCase()?1:"TUE"===a?.toUpperCase()?2:"WED"===a?.toUpperCase()?3:"THU"===a?.toUpperCase()?4:"FRI"===a?.toUpperCase()?5:"SAT"===a?.toUpperCase()?6:void 0;n&&e.push(n)}else e.push(Number(t));var a})),n.selectedWeeks=e,n}if("*"===o&&"monthly"===e){if("?"===l&&!isNaN(r)&&!isNaN(parseFloat(r)))return n.monthOption="standard",n.selectedMonthDate=Number(r),n;if(n.monthOption="custom","?"===l)r.includes("L")&&(n.selectedMonthDayOrder="Last"),r.includes("W")?(n.selectedMonthDay="Weekday",n.selectedMonthDayOrder=g(r.slice(0,1))):n.selectedMonthDay="Day";else if(l.includes("L")){const e=y.find((e=>e.value===Number(l.slice(0,1))));n.selectedMonthDay=e?.name}else if(l.includes("#")){n.selectedMonthDayOrder=g(l.charAt(l.length-1));const e=y.find((e=>e.value===Number(l.slice(0,1))));n.selectedMonthDay=e?.name}return n}return n};function C(e,t){void 0===t&&(t={});var a=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css","top"===a&&n.firstChild?n.insertBefore(l,n.firstChild):n.appendChild(l),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(document.createTextNode(e))}}var v={mainContainer:"DateSelection-module_mainContainer__Jn8mk",endTypeSelector:"DateSelection-module_endTypeSelector__o9x-Y",endContainer:"DateSelection-module_endContainer__vEHSM",startDate:"DateSelection-module_startDate__-Y2W4",endSelector:"DateSelection-module_endSelector__B6zvu",input:"DateSelection-module_input__yes3x"};function x(){const{recurrenceData:t,dispatch:a}=n(u),{selectedEndType:l,startDate:o,endDate:r,endCount:d,disabled:i}=t;return e.createElement("div",{className:v.mainContainer},e.createElement("div",{className:v.startContainer},e.createElement("label",{for:"start"},"Start"),e.createElement("input",{disabled:i,value:o,onChange:e=>{a({type:c.SetStartDate,payload:e?.target?.value})},className:v.startDate,type:"date",id:"start",name:"start"})),e.createElement("div",{className:v.endContainer},e.createElement("label",null,"End"),e.createElement("select",{disabled:i,value:l,className:v.endTypeSelector,onChange:e=>{a({type:c.SetEndType,payload:e?.target?.value})}},e.createElement("option",{value:"noend"},"no end date"),e.createElement("option",{value:"date"},"on this day"),e.createElement("option",{value:"count"},"after")),"date"===l?e.createElement("input",{disabled:i,value:r,onChange:e=>{a({type:c.SetEndDate,payload:e?.target?.value})},className:v.endDate,type:"date",id:"end",name:"end"}):"count"===l?e.createElement(e.Fragment,null,e.createElement("input",{disabled:i,value:d,onChange:e=>{a({type:c.SetEndCount,payload:e?.target?.value})},className:v.input,type:"number",min:1,defaultValue:10}),e.createElement("label",{style:{marginLeft:10}},"occurance")):null))}C("@media only screen and (min-width:641px){.DateSelection-module_mainContainer__Jn8mk{display:flex;flex-direction:row}.DateSelection-module_endTypeSelector__o9x-Y{margin-left:20px}}@media only screen and (max-width:641px){.DateSelection-module_endContainer__vEHSM{margin-top:20px}.DateSelection-module_endTypeSelector__o9x-Y{margin-left:24px}}.DateSelection-module_mainContainer__Jn8mk{margin-top:20px}.DateSelection-module_startDate__-Y2W4{margin-left:20px;margin-right:20px}.DateSelection-module_endTypeSelector__o9x-Y{margin-right:20px}.DateSelection-module_endSelector__B6zvu{margin-left:20px;margin-right:20px}.DateSelection-module_input__yes3x{width:50px}");var k={mainContainer:"Frequency-module_mainContainer__uyQ55",frequencyContainer:"Frequency-module_frequencyContainer__VDM6E",input:"Frequency-module_input__wuVfu",labelRepeat:"Frequency-module_labelRepeat__kpSyh",selectRepeat:"Frequency-module_selectRepeat__yPTcE",labelEvery:"Frequency-module_labelEvery__tvws5",labelResult:"Frequency-module_labelResult__NlacK"};C("@media only screen and (min-width:641px){.Frequency-module_mainContainer__uyQ55{display:flex;flex-direction:row}}@media only screen and (max-width:641px){.Frequency-module_frequencyContainer__VDM6E{margin-top:20px}.Frequency-module_input__wuVfu{margin-left:6px}}.Frequency-module_labelRepeat__kpSyh{margin-right:20px}.Frequency-module_selectRepeat__yPTcE{margin-right:40px;width:80px}.Frequency-module_labelEvery__tvws5{margin-right:20px}.Frequency-module_input__wuVfu{width:50px}.Frequency-module_labelResult__NlacK{margin-left:10px}");const M=["weekly","monthly"];function w(t){const{recurrenceData:a,dispatch:l}=n(u),{repeat:o,showFrequency:r,frequency:d,disabled:i}=a;return e.createElement("div",{className:k.mainContainer,style:t?.styles?.frequencyContainer},e.createElement("div",null,e.createElement("label",{className:k.labelRepeat},"Repeat"),e.createElement("select",{disabled:i,value:o,className:k.selectRepeat,name:"repeat",id:"repeat",onChange:e=>{l({type:c.SetRepeat,payload:e?.target?.value})}},M.map((t=>e.createElement("option",{value:t},t))))),r&&e.createElement("div",{className:k.frequencyContainer},e.createElement("label",{className:k.labelEvery},"Every"),e.createElement("input",{disabled:i,className:k.input,value:d,onChange:e=>{l({type:c.SetFrequency,payload:e?.target?.value})},type:"number",min:1,defaultValue:1}),e.createElement("label",{className:k.labelResult},o.slice(0,-2),"(s)")))}var N={container:"MonthSelection-module_container__7AbBI",orLabel:"MonthSelection-module_orLabel__jqTMH",mainContainer:"MonthSelection-module_mainContainer__Orlve",standardContainer:"MonthSelection-module_standardContainer__1EEb-",customContainer:"MonthSelection-module_customContainer__4XPHq",dateSelector:"MonthSelection-module_dateSelector__C1fNg",daySelector:"MonthSelection-module_daySelector__KkPVH",dayLabel:"MonthSelection-module_dayLabel__C04BX",onLabel:"MonthSelection-module_onLabel__TJ8AO"};C("@media only screen and (min-width:641px){.MonthSelection-module_container__7AbBI{display:flex;flex-direction:row}}@media only screen and (max-width:641px){.MonthSelection-module_orLabel__jqTMH{visibility:hidden}}.MonthSelection-module_mainContainer__Orlve{display:flex;flex-direction:row;margin-top:20px}.MonthSelection-module_customContainer__4XPHq,.MonthSelection-module_standardContainer__1EEb-{display:flex;flex-direction:row}.MonthSelection-module_dateSelector__C1fNg{margin-left:10px;width:50px}.MonthSelection-module_daySelector__KkPVH{margin-left:10px;margin-right:10px;width:100px}.MonthSelection-module_dayLabel__C04BX,.MonthSelection-module_orLabel__jqTMH{margin-left:10px;margin-right:10px}.MonthSelection-module_onLabel__TJ8AO{margin-right:20px}");const W=[...Array(32).keys()].filter((e=>0!==e)),F=["First","Second","Third","Fourth","Last"];function q(t){const{recurrenceData:a,dispatch:l}=n(u),{monthOption:o,selectedMonthDate:r,selectedMonthDayOrder:d,selectedMonthDay:i,disabled:s}=a,m=e=>{l({type:c.SetMonthOption,payload:e?.target?.value})};return e.createElement("div",{className:N.mainContainer},e.createElement("label",{className:N.onLabel},"on"),e.createElement("div",{className:N.container},e.createElement("div",{className:N.standardContainer},e.createElement("input",{disabled:s,value:"standard",name:"monthOption",checked:"standard"===o,type:"radio",onChange:m}),e.createElement("select",{disabled:s||"standard"!==o,value:r,className:N.dateSelector,onChange:e=>{l({type:c.SetMonthDate,payload:e?.target?.value})}},W.map((t=>e.createElement("option",{value:t},t)))),e.createElement("label",{style:{color:""+("standard"!==o||s?"gray":"")},className:N.dayLabel},"day")),e.createElement("label",{className:N.orLabel},"or"),e.createElement("div",{className:N.customContainer},e.createElement("input",{disabled:s,value:"custom",name:"monthOption",checked:"custom"===o,type:"radio",onChange:m}),e.createElement("select",{disabled:s||"custom"!==o,value:d,className:N.daySelector,onChange:e=>{l({type:c.SetMonthDayOrder,payload:e?.target?.value})}},F.map((t=>{const a=!["First","Last"].includes(t)&&"Weekday"===i;return e.createElement("option",{disabled:a,value:t},t)}))),e.createElement("select",{disabled:s||"custom"!==o,value:i,className:N.daySelector,onChange:e=>{l({type:c.SetMonthDay,payload:e?.target?.value})}},(()=>{let e=[...y];return e=e.concat([{name:"Day",value:"Day"},{name:"Weekday",value:"Weekday"}]),e})().map((t=>{const a="Weekday"===t.name&&!["First","Last"].includes(d);return e.createElement("option",{disabled:a,value:t.name},t.name)}))))))}const O=e=>{const t=new Date(e),a=y.find((e=>e.value===t?.getDay()))?.name;return a},L=e=>{const t=new Date(e);return _[t.getMonth()]},T=e=>{const t=new Date(e).getDate();return t>9?t:`0${t}`};function R(t){const{recurrenceData:a,dispatch:o}=n(u),{startDate:r,repeat:c,selectedWeeks:d,frequency:i,monthOption:s,selectedMonthDate:m,selectedMonthDayOrder:p,selectedMonthDay:_}=a,h=l((()=>{if(!r)return"";const e=new Date(r),t=O(r),a=L(r);return`starting ${t}, ${T(r)} ${a} ${e.getFullYear()}`}),[r]),S=l((()=>{let e=d;if(r){const t=new Date(r);e=d.filter((e=>e>=t.getDay())).concat(d.filter((e=>e<t.getDay())))}const t=[];if(e.forEach((e=>{const a=y.find((t=>t.value===e));a.name&&t.push(a.name)})),t.length>1){const e=t.pop(),a=t.pop();t.push(`${a} and ${e}`)}return t.join(", ")}),[r,d]);if("weekly"===c&&d?.length>0)return e.createElement("div",{style:{marginTop:20}},"Occurs",e.createElement("span",{style:{fontWeight:"bold",marginLeft:5,marginRight:5}},"every ",i>1?"weeks on":""," ",S()),h());if("monthly"===c){const t="standard"===s?`day ${m}`:`the ${p?.toLowerCase()} ${_}`;return e.createElement("div",{style:{marginTop:20}},"Occurs",e.createElement("span",{style:{fontWeight:"bold",marginLeft:5,marginRight:5}},t," of every ",i>1?"months":"month"),h())}return e.createElement(e.Fragment,null)}var $={container:"WeekSelection-module_container__88GLb",weekCheckBoxContainer:"WeekSelection-module_weekCheckBoxContainer__-iuB5",dayContainer:"WeekSelection-module_dayContainer__SF52n",weekCircle:"WeekSelection-module_weekCircle__XtUDq",selectedWeekCircle:"WeekSelection-module_selectedWeekCircle__78txD",checkboxLabel:"WeekSelection-module_checkboxLabel__pBlZa"};function B(t){const{recurrenceData:a,dispatch:l}=n(u),{selectedWeeks:o,disabled:r}=a,d=e=>{const t=o.includes(e)?o.filter((t=>t!==e)).sort():o.concat([e]).sort();l({type:c.SetSelectedWeeks,payload:t})},i=e=>{let t=e?.target?.value;t&&(t=Number(t),d(t))};return e.createElement("div",{style:t?.styles?.weekContainer},e.createElement("div",{className:$.container},y.map(((t,a)=>e.createElement("div",{key:a,className:$.dayContainer},e.createElement("button",{type:"button",disabled:r,value:t.value,className:o.includes(t.value)?$.selectedWeekCircle:$.weekCircle,onClick:e=>d(t.value)},t.name.slice(0,3)))))),e.createElement("div",{className:$.weekCheckBoxContainer},y.map((t=>e.createElement("label",null,e.createElement("input",{disabled:r,checked:o.includes(t.value),type:"checkbox",onChange:i,value:t.value}),e.createElement("span",{className:$.checkboxLabel},t.name))))))}function U(t){const{recurrenceData:a,dispatch:l}=n(u),{repeat:r,selectedWeeks:d,cronExpression:i,monthOption:s,selectedMonthDate:m,selectedMonthDay:p,selectedMonthDayOrder:y,frequency:_,startDate:g,endDate:C,endCount:v,selectedEndType:k}=a;return o((()=>{let e={...t};if(t.cronExpression&&""!==t.cronExpression){const a=f(t.repeat,t.cronExpression);a&&(e={...e,...a})}l({type:c.SetInitialProps,payload:e})}),[t]),o((()=>{let e="";if("weekly"===r)e=h(d);else if("monthly"===r)if("custom"===s){const t=b(y);"Day"===p?e="Last"===y?"0 0 L * ?":S(t):"Weekday"===p?"First"===y?e="0 0 1W * ?":"Last"===y&&(e="0 0 LW * ?"):e="Last"===y?D(p):E(t,p)}else e=S(m);l({type:c.SetCronExp,payload:e})}),[r,d,s,m,p,y]),o((()=>{const e={repeat:r,cronExpression:i,frequency:_,startDate:g};"date"===k?e.endDate=C:"count"===k&&(e.endCount=v),t.onChange&&t.onChange(e)}),[r,i,_,g,C,v,k]),e.createElement("div",{style:t?.styles?.root},e.createElement(w,t),"weekly"===r?e.createElement(B,t):"monthly"===r?e.createElement(q,null):null,e.createElement(x,null),e.createElement(R,null),t.showCronExpression&&e.createElement("div",{style:{marginTop:20}},i))}C('@media only screen and (min-width:641px){.WeekSelection-module_container__88GLb{display:flex;flex-direction:row}.WeekSelection-module_weekCheckBoxContainer__-iuB5{display:none}}@media only screen and (max-width:641px){.WeekSelection-module_container__88GLb{display:none}.WeekSelection-module_weekCheckBoxContainer__-iuB5{display:flex;flex-direction:column;margin-top:20px}}.WeekSelection-module_dayContainer__SF52n{margin:10px}.WeekSelection-module_weekCircle__XtUDq{background-color:#aaa}.WeekSelection-module_selectedWeekCircle__78txD,.WeekSelection-module_weekCircle__XtUDq{border:1px;border-color:"#6b6b6b";border-radius:50%;color:#e2e2e2;height:40px;width:40px}.WeekSelection-module_selectedWeekCircle__78txD{background-color:#4eaeec}.WeekSelection-module_checkboxLabel__pBlZa{margin-left:5px}');const P=t=>e.createElement(p,null,e.createElement(U,r({},t,{root:root})));export{P as Recurrence};
